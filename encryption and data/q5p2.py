import base64
import requests
import json
import libsodium
import nacl.secret
import nacl.utils
import nacl.hash
import nacl.encoding
from nacl.public import PrivateKey, Box
import random

token = "35d15be0f7cb11c2d0e9548ce2c9246b9148bf53d0587d764821c0c33a8a86ae"
r = requests.post(
    url="https://hash-browns.cs.uwaterloo.ca/api/surveil/inbox",
    headers={"Content-Type":"application/json", "Accept":"application/json"}, 
    json={"api_token": token}
    )
print(f"Status Code: {r.status_code}, Response: {r.json()}")

pkMuffin = nacl.public.PublicKey(base64.b64decode('XfA9thgSDQdHoEcjmIpBn3ma2dDMp0OXRmuyf5Qq3kE='))
skme = nacl.public.PrivateKey(b'\xe8\\,\xd8\xb3\x1b\x17ad\x00&\x8cu\xac\xbd\xd3\xbc\xa9Sa\xc4\xaa{f\xb4A\xa3m\x17\xf8\x11E')
Muffin_box = Box(skme, pkMuffin)

message = base64.b64decode(json.loads(r.content)[0]['msg'])
recipient_key = base64.b64decode(json.loads(r.content)[0]['recipient_key'])

recipient_key = Muffin_box.decrypt(recipient_key)
box = nacl.secret.SecretBox(recipient_key)

print(box.decrypt(message).decode('utf-8'))
