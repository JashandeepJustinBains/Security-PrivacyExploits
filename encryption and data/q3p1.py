import base64
import requests
import json
import libsodium
import nacl.secret
import nacl.utils
from nacl.signing import SigningKey
import random

token = "35d15be0f7cb11c2d0e9548ce2c9246b9148bf53d0587d764821c0c33a8a86ae"
reciever = "Muffin"
URL = "https://hash-browns.cs.uwaterloo.ca/api/signed/set-key"
# generate signature and verification key and save to file
signing_key = SigningKey.generate()
print(str(signing_key)[2:-1])

verify = signing_key.verify_key
encrypted = verify
print(verify)
with open ("savedkeys.txt", 'wb') as outfile:
    outfile.write(str(signing_key).encode('utf-8'))

r = requests.post(
    url=URL,
    headers={"Content-Type":"application/json", "Accept":"application/json"}, 
    json={
        "api_token": token,
        "pubkey": str(base64.b64encode(verify.encode()))[2:-1]
        }
    )
print(f"Status Code: {r.status_code}, Response: {r.json()}")
